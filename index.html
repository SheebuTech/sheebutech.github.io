<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShibuHelper - Student Tools Suite</title>
    <meta name="theme-color" content="#0f172a">
    <link rel="manifest" href="/manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        /* Reset & Base */
        :root {
            --bg-main: linear-gradient(135deg, #0f172a, #1e293b);
            --card-bg: rgba(30, 41, 59, 0.7);
            --card-border: rgba(255, 255, 255, 0.1);
            --primary: #3b82f6;
            --primary-glow: rgba(59, 130, 246, 0.4);
            --accent: #06b6d4;
            --success: #10b981;
            --danger: #ef4444;
            --text-light: #f8fafc;
            --text-gray: #94a3b8;
            --shadow: 0 10px 35px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --glass: blur(12px) saturate(180%);
            --radius: 20px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-main);
            background-attachment: fixed;
            color: var(--text-light);
            min-height: 100vh;
            padding-bottom: 90px;
            overflow-x: hidden;
        }

        /* Typography */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        h1, h2, h3 { font-weight: 700; letter-spacing: -0.5px; }
        p { line-height: 1.6; }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
            animation: pulse 15s infinite alternate;
        }

        @keyframes pulse {
            0% { transform: scale(0.95); }
            100% { transform: scale(1.05); }
        }

        /* Header */
        .app-header {
            padding: 20px;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: var(--glass);
            position: sticky;
            top: 0;
            z-index: 50;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo i { font-size: 1.8rem; }

        .status-badge {
            font-size: 0.75rem;
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid rgba(16, 185, 129, 0.3);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Container */
        .container {
            max-width: 650px;
            margin: 0 auto;
            padding: 20px 15px;
            position: relative;
            z-index: 1;
        }

        /* Panels */
        .tool-panel {
            display: none;
            animation: slideUp 0.4s cubic-bezier(0.2, 0, 0.4, 1);
        }

        .tool-panel.active {
            display: block;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            backdrop-filter: var(--glass);
            border-radius: var(--radius);
            padding: 24px;
            border: 1px solid var(--card-border);
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .section-title {
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-light);
        }

        .section-title i {
            color: var(--primary);
            background: rgba(59, 130, 246, 0.1);
            padding: 8px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }

        /* Upload Box */
        .upload-box {
            border: 2px dashed var(--card-border);
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.03);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .upload-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--primary-glow) 0%, transparent 70%);
            opacity: 0;
            transition: var(--transition);
            pointer-events: none;
        }

        .upload-box:hover {
            border-color: var(--primary);
            background: rgba(59, 130, 246, 0.05);
        }

        .upload-box:active {
            transform: scale(0.98);
        }

        .upload-box:hover::before {
            opacity: 1;
        }

        .upload-box i {
            font-size: 2.5rem;
            color: var(--primary);
            transition: var(--transition);
        }

        .upload-box:hover i {
            transform: translateY(-5px);
            color: #60a5fa;
        }

        .upload-box p {
            margin: 10px 0 0;
            font-weight: 500;
        }

        .file-info {
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--accent);
            font-weight: 600;
            background: rgba(6, 182, 212, 0.1);
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
        }

        /* Inputs */
        .input-group {
            margin-bottom: 18px;
        }

        .label {
            display: block;
            color: var(--text-gray);
            font-size: 0.9rem;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--card-border);
            padding: 14px;
            border-radius: 12px;
            color: var(--text-light);
            font-size: 1rem;
            transition: var(--transition);
            font-family: inherit;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-glow);
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
            pointer-events: none;
        }

        .btn:active::after {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 20px rgba(37, 99, 235, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(37, 99, 235, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            margin-top: 15px;
            text-decoration: none;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 18px rgba(16, 185, 129, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--card-border);
            color: var(--text-gray);
            margin-top: 10px;
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Preview */
        .preview-container {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .preview-img {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .size-badge {
            background: rgba(0, 0, 0, 0.5);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin: 5px;
            display: inline-block;
        }

        /* Accordion */
        details {
            margin-bottom: 15px;
            color: var(--text-gray);
            font-size: 0.9rem;
        }

        details summary {
            cursor: pointer;
            font-weight: 500;
            padding: 8px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            list-style: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        details summary::before {
            content: '‚ñ∂';
            font-size: 0.7rem;
            transition: transform 0.2s;
        }

        details[open] summary::before {
            transform: rotate(90deg);
        }

        details summary:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        details[open] summary {
            color: var(--primary);
        }

        /* Loader */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(30, 41, 59, 0.8);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            box-shadow: 0 0 25px var(--primary-glow);
        }

        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: var(--glass);
            border-top: 1px solid var(--card-border);
            display: flex;
            justify-content: space-around;
            padding: 12px 5px;
            z-index: 100;
            box-shadow: 0 -5px 30px rgba(0, 0, 0, 0.3);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-gray);
            font-size: 0.75rem;
            background: none;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            padding: 8px 12px;
            border-radius: 15px;
            min-width: 70px;
        }

        .nav-item i {
            font-size: 1.4rem;
            margin-bottom: 4px;
            transition: var(--transition);
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(59, 130, 246, 0.15);
            transform: translateY(-5px) scale(1.1);
        }

        .nav-item:not(.active):hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-2px);
        }

        /* Range Slider */
        input[type="range"] {
            -webkit-appearance: none;
            height: 6px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            padding: 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 8px var(--primary-glow);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            backdrop-filter: var(--glass);
            color: var(--text-light);
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            z-index: 300;
            display: none;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.4s cubic-bezier(0.2, 0, 0.4, 1);
            border: 1px solid var(--card-border);
            min-width: 250px;
        }

        .toast.show { display: flex; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.info { border-left: 4px solid var(--primary); }

        /* Responsive */
        @media (min-width: 768px) {
            .container { padding: 30px; }
            .card { padding: 28px; }
        }

        /* Hidden class */
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <header class="app-header">
        <div class="logo">
            <i class="fas fa-user-graduate"></i>
            ShibuHelper
        </div>
        <div class="status-badge">
            <i class="fas fa-check-circle"></i>
            v3.5 Premium
        </div>
    </header>

    <main class="container">
        <!-- Compress Panel -->
        <section id="panel-compress" class="tool-panel active">
            <div class="card">
                <div class="section-title">
                    <i class="fas fa-magic"></i>
                    Smart Compressor (Pinpoint Accuracy)
                </div>
                <div class="upload-box" onclick="document.getElementById('c-input').click()">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç</p>
                    <small>JPEG, PNG, WEBP supported</small>
                    <input type="file" id="c-input" hidden accept="image/*">
                </div>
                
                <div id="c-controls" class="hidden">
                    <div class="input-group">
                        <label class="label">‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø ‡§Ü‡§ï‡§æ‡§∞ (KB) - ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç</label>
                        <input type="number" id="c-target" placeholder="‡§â‡§¶‡§æ. 40 (SSC), 50 (Govt Jobs)" value="50">
                    </div>
                    
                    <details>
                        <summary>‡§â‡§®‡•ç‡§®‡§§ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‚öôÔ∏è</summary>
                        <div style="margin-top:10px;">
                            <div class="input-group">
                                <label class="label">‡§Æ‡•à‡§®‡•Å‡§Ö‡§≤ ‡§ö‡•å‡§°‡§º‡§æ‡§à (px) - ‡§®‡§π‡•Ä‡§Ç ‡§§‡•ã ‡§ñ‡§æ‡§≤‡•Ä ‡§õ‡•ã‡§°‡§º‡•á‡§Ç</label>
                                <input type="number" id="c-width" placeholder="‡§â‡§¶‡§æ. 600">
                            </div>
                            <div class="input-group">
                                <label class="label">‡§™‡•ç‡§∞‡§æ‡§∞‡•Ç‡§™ ‡§ö‡•Å‡§®‡•á</label>
                                <select id="c-format">
                                    <option value="jpeg">JPEG (‡§∏‡§¨‡§∏‡•á ‡§õ‡•ã‡§ü‡§æ)</option>
                                    <option value="png">PNG (‡§ü‡•ç‡§∞‡§æ‡§Ç‡§∏‡§™‡•á‡§∞‡•á‡§Ç‡§ü)</option>
                                    <option value="webp">WebP (Best Quality)</option>
                                </select>
                            </div>
                        </div>
                    </details>

                    <button class="btn btn-primary" onclick="compressImage()">
                        <i class="fas fa-bolt"></i>
                        ‡§ï‡§Ç‡§™‡•ç‡§∞‡•á‡§∏ ‡§ï‡§∞‡•ã (100% ‡§è‡§ï‡•ç‡§Ø‡•Ç‡§∞‡•á‡§ü)
                    </button>

                    <div id="c-result" class="preview-container">
                        <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                            <span class="size-badge" id="c-original-size">‡§Æ‡•Ç‡§≤: 0 KB</span>
                            <span class="size-badge" style="color:#4ade80;" id="c-final-size">‡§®‡§Ø‡§æ: 0 KB</span>
                        </div>
                        <img id="c-img-out" class="preview-img">
                        <a id="c-dl-btn" class="btn btn-success" download>
                            <i class="fas fa-download"></i>
                            ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Passport Panel -->
        <section id="panel-passport" class="tool-panel">
            <div class="card">
                <div class="section-title">
                    <i class="fas fa-print"></i>
                    Passport Grid (‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§∞‡•á‡§°‡•Ä)
                </div>
                <div class="upload-box" onclick="document.getElementById('pp-input').click()">
                    <i class="fas fa-user-circle"></i>
                    <p>‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</p>
                    <input type="file" id="pp-input" hidden accept="image/*">
                </div>
                
                <div id="pp-controls" class="hidden">
                    <div class="input-group">
                        <label class="label">‡§™‡•á‡§™‡§∞ ‡§∏‡§æ‡§á‡§ú‡§º ‡§ö‡•Å‡§®‡•á‡§Ç</label>
                        <select id="pp-paper">
                            <option value="4x6">4x6 ‡§á‡§Ç‡§ö (8 ‡§´‡•ã‡§ü‡•ã)</option>
                            <option value="a4">A4 ‡§∏‡§æ‡§á‡§ú‡§º (30+ ‡§´‡•ã‡§ü‡•ã)</option>
                            <option value="3.5x5">3.5x5 ‡§á‡§Ç‡§ö (4 ‡§´‡•ã‡§ü‡•ã)</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label class="label">‡§´‡•ã‡§ü‡•ã ‡§∏‡§æ‡§á‡§ú‡§º ‡§∏‡•ç‡§ü‡•à‡§Ç‡§°‡§∞‡•ç‡§°</label>
                        <select id="pp-size">
                            <option value="35x45">35x45 mm (‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü)</option>
                            <option value="2x2">2x2 ‡§á‡§Ç‡§ö (US ‡§µ‡•Ä‡§ú‡§º‡§æ)</option>
                            <option value="30x40">30x40 mm (NEET)</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" onclick="createPassportGrid()">
                        <i class="fas fa-print"></i>
                        ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§∂‡•Ä‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç
                    </button>

                    <div id="pp-result" class="preview-container">
                        <img id="pp-img-out" class="preview-img">
                        <a id="pp-dl-btn" class="btn btn-success" download>
                            <i class="fas fa-download"></i>
                            ‡§∂‡•Ä‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Image to PDF Panel -->
        <section id="panel-i2p" class="tool-panel">
            <div class="card">
                <div class="section-title">
                    <i class="fas fa-file-pdf"></i>
                    Images to PDF (‡§∏‡•ã‡§∞‡•ç‡§ü‡•á‡§¨‡§≤)
                </div>
                <div class="upload-box" onclick="document.getElementById('i2p-input').click()">
                    <i class="fas fa-images"></i>
                    <p>‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞‡•á‡§Ç ‡§ö‡•Å‡§®‡•á‡§Ç (‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•à)</p>
                    <div id="i2p-count" class="file-info hidden"></div>
                    <div id="sortable-list" style="margin-top:15px; text-align:left;"></div>
                    <input type="file" id="i2p-input" hidden accept="image/*" multiple>
                </div>
                <button id="i2p-btn" class="btn btn-primary hidden" onclick="imagesToPdf()">
                    <i class="fas fa-convert"></i>
                    PDF ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç
                </button>
                <a id="i2p-dl-btn" class="btn btn-success hidden">
                    <i class="fas fa-download"></i>
                    PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
                </a>
            </div>
        </section>

        <!-- Tools Panel -->
        <section id="panel-tools" class="tool-panel">
            <div class="card">
                <div class="section-title">
                    <i class="fas fa-signature"></i>
                    Signature Cleaner (AI Style)
                </div>
                <div class="upload-box" onclick="document.getElementById('s-input').click()">
                    <i class="fas fa-pen-nib"></i>
                    <p>‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</p>
                    <input type="file" id="s-input" hidden accept="image/*">
                </div>
                <div id="s-controls" class="hidden">
                    <div class="input-group">
                        <label class="label">‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° ‡§∞‡§ø‡§Æ‡•Ç‡§µ‡§≤ ‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§Ç‡§•</label>
                        <input type="range" id="s-thresh" min="100" max="200" value="150">
                        <p style="text-align:center; font-size:0.85rem; color:var(--text-gray); margin-top:5px;">
                            ‡§¨‡§æ‡§è‡§Ç = ‡§≤‡§æ‡§á‡§ü‡§∞, ‡§¶‡§æ‡§è‡§Ç = ‡§°‡§æ‡§∞‡•ç‡§ï‡§∞
                        </p>
                    </div>
                    <button class="btn btn-primary" onclick="cleanSignature()">
                        <i class="fas fa-eraser"></i>
                        ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° ‡§π‡§ü‡§æ‡§è‡§Ç
                    </button>
                    <div id="s-result" class="preview-container" style="background:white;">
                        <img id="s-img-out" class="preview-img">
                        <a id="s-dl-btn" class="btn btn-success" download>
                            <i class="fas fa-download"></i>
                            PNG ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
                        </a>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="section-title">
                    <i class="fas fa-layer-group"></i>
                    Merge PDFs (Drag & Drop)
                </div>
                <div class="upload-box" onclick="document.getElementById('m-input').click()">
                    <i class="fas fa-file-pdf"></i>
                    <p>PDF ‡§´‡§æ‡§á‡§≤‡•á‡§Ç ‡§ö‡•Å‡§®‡•á‡§Ç (‡§ï‡§à)</p>
                    <input type="file" id="m-input" hidden accept="application/pdf" multiple>
                    <div id="m-count" class="file-info hidden"></div>
                </div>
                <button id="m-btn" class="btn btn-primary hidden" onclick="mergePDFs()">
                    <i class="fas fa-compress-alt"></i>
                    ‡§Æ‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç
                </button>
                <a id="m-dl-btn" class="btn btn-success hidden">
                    <i class="fas fa-download"></i>
                    ‡§Æ‡§∞‡•ç‡§ú‡•ç‡§° PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
                </a>
            </div>
        </section>
    </main>

    <nav class="bottom-nav">
        <button class="nav-item active" onclick="switchTab('compress', this)" title="‡§ï‡§Ç‡§™‡•ç‡§∞‡•á‡§∏">
            <i class="fas fa-compress-alt"></i>
            <span>‡§ï‡§Ç‡§™‡•ç‡§∞‡•á‡§∏</span>
        </button>
        <button class="nav-item" onclick="switchTab('passport', this)" title="‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü">
            <i class="fas fa-id-card"></i>
            <span>‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü</span>
        </button>
        <button class="nav-item" onclick="switchTab('i2p', this)" title="‡§á‡§Æ‡•á‡§ú ‡§∏‡•á PDF">
            <i class="fas fa-image"></i>
            <span>Img2PDF</span>
        </button>
        <button class="nav-item" onclick="switchTab('tools', this)" title="‡§Ö‡§®‡•ç‡§Ø ‡§ü‡•Ç‡§≤‡•ç‡§∏">
            <i class="fas fa-tools"></i>
            <span>‡§ü‡•Ç‡§≤‡•ç‡§∏</span>
        </button>
    </nav>

    <div id="loader" class="loader">
        <div class="spinner"></div>
        <p style="color:white; margin-top:15px; font-weight:600;">‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...</p>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        /* ========= CORE UTILITIES ========= */
        const $ = id => document.getElementById(id);
        const loader = (show) => $('loader').style.display = show ? 'flex' : 'none';
        const formatBytes = (bytes) => (bytes / 1024).toFixed(1) + ' KB';
        
        let toastTimeout;
        function showToast(message, type = 'success') {
            const toast = $('toast');
            clearTimeout(toastTimeout);
            toast.className = `toast ${type}`;
            toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>${message}`;
            toast.classList.add('show');
            toastTimeout = setTimeout(() => toast.classList.remove('show'), 4000);
        }

        function switchTab(panelId, btn) {
            document.querySelectorAll('.tool-panel').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            $(`panel-${panelId}`).classList.add('active');
            btn.classList.add('active');
            showToast(`${btn.querySelector('span').textContent} ‡§ñ‡•ã‡§≤‡§æ ‡§ó‡§Ø‡§æ`, 'info');
        }

        /* ========= IMAGE COMPRESSION ========= */
        let cFile = null;
        $('c-input').addEventListener('change', e => {
            if(e.target.files[0]) {
                cFile = e.target.files[0];
                $('c-controls').classList.remove('hidden');
                $('c-original-size').innerText = `‡§Æ‡•Ç‡§≤: ${formatBytes(cFile.size)}`;
                showToast('‡§´‡•ã‡§ü‡•ã ‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§à!', 'success');
            }
        });

        async function compressImage() {
            if(!cFile) return showToast('‡§™‡§π‡§≤‡•á ‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç', 'error');
            loader(true);
            
            try {
                const targetKB = parseInt($('c-target').value) || 50;
                const targetBytes = targetKB * 1024;
                const customWidth = $('c-width').value ? parseInt($('c-width').value) : 0;
                const format = $('c-format').value;

                const img = await loadImage(URL.createObjectURL(cFile));
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');

                // Smart resizing
                let w = customWidth || img.width;
                let h = customWidth ? (img.height * (customWidth/img.width)) : img.height;
                
                // Don't upscale small images
                if(w > img.width) { w = img.width; h = img.height; }
                
                canvas.width = w;
                canvas.height = h;
                ctx.drawImage(img, 0, 0, w, h);

                // Perfect binary search compression
                let minQ = 0.1, maxQ = 1.0, quality = 0.9;
                let dataUrl = '';
                const mimeType = format === 'jpeg' ? 'image/jpeg' : format === 'png' ? 'image/png' : 'image/webp';

                for(let i=0; i<8; i++) {
                    quality = (minQ + maxQ) / 2;
                    dataUrl = canvas.toDataURL(mimeType, quality);
                    let size = Math.round((dataUrl.length - 'data:;base64,'.length) * 0.75);

                    if(size > targetBytes) maxQ = quality - 0.05;
                    else minQ = quality + 0.05;
                }

                // Final output
                $('c-img-out').src = dataUrl;
                $('c-result').style.display = 'block';
                
                const blob = await (await fetch(dataUrl)).blob();
                $('c-final-size').innerText = `‡§®‡§Ø‡§æ: ${formatBytes(blob.size)}`;
                
                const btn = $('c-dl-btn');
                btn.href = dataUrl;
                btn.download = `Compressed_${targetKB}KB.${format}`;
                btn.style.display = 'flex';
                
                showToast(`‚úÖ ${formatBytes(blob.size)} ‡§Æ‡•á‡§Ç ‡§ï‡§Ç‡§™‡•ç‡§∞‡•á‡§∏ ‡§π‡•ã ‡§ó‡§Ø‡§æ!`, 'success');
            } catch(e) {
                showToast('‡§ï‡§Ç‡§™‡•ç‡§∞‡•á‡§∂‡§® ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + e.message, 'error');
            } finally {
                loader(false);
            }
        }

        /* ========= PASSPORT GRID ========= */
        let ppFile = null;
        $('pp-input').addEventListener('change', e => {
            if(e.target.files[0]) {
                ppFile = e.target.files[0];
                $('pp-controls').classList.remove('hidden');
                showToast('‡§´‡•ã‡§ü‡•ã ‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§à!', 'success');
            }
        });

        async function createPassportGrid() {
            if(!ppFile) return showToast('‡§™‡§π‡§≤‡•á ‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç', 'error');
            loader(true);

            try {
                const paperSize = $('pp-paper').value;
                const photoStandard = $('pp-size').value;
                const img = await loadImage(URL.createObjectURL(ppFile));

                // Standard dimensions
                const standards = {
                    '35x45': { width: 35, height: 45, dpi: 300 }, // mm
                    '2x2': { width: 2, height: 2, dpi: 300 }, // inch
                    '30x40': { width: 30, height: 40, dpi: 300 } // mm
                };

                const std = standards[photoStandard];
                const photoW = (std.width / 25.4 * std.dpi); // mm to pixels
                const photoH = (std.height / 25.4 * std.dpi);

                // Canvas setup based on paper
                const configs = {
                    '4x6': { width: 1200, height: 1800, cols: 2, rows: 4, gapX: 30, gapY: 40 },
                    'a4': { width: 2480, height: 3508, cols: 5, rows: 7, gapX: 20, gapY: 30 },
                    '3.5x5': { width: 1050, height: 1500, cols: 2, rows: 3, gapX: 25, gapY: 35 }
                };

                const config = configs[paperSize];
                const canvas = document.createElement('canvas');
                canvas.width = config.width;
                canvas.height = config.height;
                const ctx = canvas.getContext('2d');
                
                // White background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Draw grid
                const startX = 50, startY = 50;
                for(let row=0; row<config.rows; row++) {
                    for(let col=0; col<config.cols; col++) {
                        const x = startX + col * (photoW + config.gapX);
                        const y = startY + row * (photoH + config.gapY);
                        
                        ctx.drawImage(img, x, y, photoW, photoH);
                        ctx.strokeStyle = '#ddd';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(x, y, photoW, photoH);
                    }
                }

                const url = canvas.toDataURL('image/jpeg', 0.95);
                $('pp-img-out').src = url;
                $('pp-result').style.display = 'block';
                $('pp-dl-btn').href = url;
                $('pp-dl-btn').download = `Passport_${photoStandard}_${paperSize}.jpg`;
                $('pp-dl-btn').style.display = 'flex';
                
                showToast(`${config.cols * config.rows} ‡§´‡•ã‡§ü‡•ã ‡§ï‡•Ä ‡§∂‡•Ä‡§ü ‡§¨‡§® ‡§ó‡§à!`, 'success');
            } catch(e) {
                showToast('‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§∂‡•Ä‡§ü ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + e.message, 'error');
            } finally {
                loader(false);
            }
        }

        /* ========= SIGNATURE CLEANER ========= */
        let sFile = null;
        $('s-input').addEventListener('change', e => {
            if(e.target.files[0]) {
                sFile = e.target.files[0];
                $('s-controls').classList.remove('hidden');
                showToast('‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success');
            }
        });

        async function cleanSignature() {
            if(!sFile) return showToast('‡§™‡§π‡§≤‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç', 'error');
            loader(true);

            try {
                const img = await loadImage(URL.createObjectURL(sFile));
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                const thresh = parseInt($('s-thresh').value);

                // Improved thresholding with edge detection
                for(let i=0; i<data.length; i+=4) {
                    const gray = (data[i] * 0.299 + data[i+1] * 0.587 + data[i+2] * 0.114);
                    if(gray > thresh) {
                        data[i+3] = 0; // Transparent
                    } else {
                        // Enhance signature
                        const dark = Math.max(0, 255 - (thresh - gray) * 3);
                        data[i] = data[i+1] = data[i+2] = dark;
                        data[i+3] = 255;
                    }
                }
                ctx.putImageData(imageData, 0, 0);
                
                const url = canvas.toDataURL('image/png');
                $('s-img-out').src = url;
                $('s-result').style.display = 'block';
                $('s-dl-btn').href = url;
                $('s-dl-btn').download = 'Signature_Clean.png';
                $('s-dl-btn').style.display = 'flex';
                
                showToast('‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§∏‡§æ‡§´‡§º ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success');
            } catch(e) {
                showToast('‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞ ‡§∏‡§´‡§æ‡§à ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + e.message, 'error');
            } finally {
                loader(false);
            }
        }

        /* ========= IMAGE TO PDF ========= */
        let i2pList = [];
        $('i2p-input').addEventListener('change', async e => {
            i2pList = Array.from(e.target.files);
            if(i2pList.length > 0) {
                $('i2p-count').innerText = `${i2pList.length} ‡§´‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•Ä ‡§ó‡§à‡§Ç`;
                $('i2p-count').classList.remove('hidden');
                $('i2p-btn').classList.remove('hidden');
                
                // Show thumbnails for reordering (future enhancement)
                showToast(`${i2pList.length} ‡§´‡•ã‡§ü‡•ã ‡§≤‡•ã‡§° ‡§π‡•Å‡§à‡§Ç`, 'success');
            }
        });

        async function imagesToPdf() {
            if(i2pList.length === 0) return showToast('‡§™‡§π‡§≤‡•á ‡§´‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç', 'error');
            loader(true);

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                for(let i=0; i<i2pList.length; i++) {
                    if(i > 0) doc.addPage();
                    
                    const img = await loadImage(URL.createObjectURL(i2pList[i]));
                    const pageWidth = doc.internal.pageSize.getWidth();
                    const pageHeight = doc.internal.pageSize.getHeight();
                    
                    // Calculate dimensions to fit page
                    const ratio = Math.min(pageWidth / img.width, pageHeight / img.height);
                    const width = img.width * ratio * 0.9; // 90% margin
                    const height = img.height * ratio * 0.9;
                    const x = (pageWidth - width) / 2;
                    const y = (pageHeight - height) / 2;
                    
                    doc.addImage(img, 'JPEG', x, y, width, height);
                }
                
                const blob = doc.output('blob');
                const url = URL.createObjectURL(blob);
                const btn = $('i2p-dl-btn');
                btn.href = url;
                btn.download = "Images_Converted.pdf";
                btn.classList.remove('hidden');
                
                showToast('PDF ‡§¨‡§® ‡§ó‡§Ø‡§æ!', 'success');
            } catch(e) {
                showToast('PDF ‡§¨‡§®‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + e.message, 'error');
            } finally {
                loader(false);
            }
        }

        /* ========= PDF MERGE ========= */
        let mList = [];
        $('m-input').addEventListener('change', e => {
            mList = Array.from(e.target.files);
            if(mList.length > 0) {
                $('m-count').innerText = `${mList.length} PDFs ‡§ö‡•Å‡§®‡•á ‡§ó‡§è`;
                $('m-count').classList.remove('hidden');
                $('m-btn').classList.remove('hidden');
                showToast(`${mList.length} PDF ‡§≤‡•ã‡§° ‡§π‡•Å‡§è`, 'success');
            }
        });

        async function mergePDFs() {
            if(mList.length === 0) return showToast('‡§™‡§π‡§≤‡•á PDF ‡§ö‡•Å‡§®‡•á‡§Ç', 'error');
            loader(true);

            try {
                const { PDFDocument } = PDFLib;
                const mergedPdf = await PDFDocument.create();

                for(let i=0; i<mList.length; i++) {
                    showToast(`‡§Æ‡§∞‡•ç‡§ú ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç... ${i+1}/${mList.length}`, 'info');
                    const arrayBuffer = await mList[i].arrayBuffer();
                    const pdf = await PDFDocument.load(arrayBuffer);
                    const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    copiedPages.forEach(page => mergedPdf.addPage(page));
                }

                const pdfBytes = await mergedPdf.save();
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                
                const btn = $('m-dl-btn');
                btn.href = url;
                btn.download = "Merged_Documents.pdf";
                btn.classList.remove('hidden');
                
                showToast('PDF ‡§Æ‡§∞‡•ç‡§ú ‡§π‡•ã ‡§ó‡§Ø‡§æ!', 'success');
            } catch(e) {
                showToast('PDF ‡§Æ‡§∞‡•ç‡§ú ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + e.message, 'error');
            } finally {
                loader(false);
            }
        }

        /* ========= HELPER FUNCTIONS ========= */
        async function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = src;
            });
        }

        /* ========= SERVICE WORKER ========= */
        if('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(() => {});
        }

        /* ========= PWA INSTALL PROMPT ========= */
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            deferredPrompt = e;
            showToast('üì≤ ‡§ê‡§™ ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡•á‡§®‡•Ç ‡§Æ‡•á‡§Ç "Add to Home Screen" ‡§ö‡•Å‡§®‡•á‡§Ç', 'info');
        });
    </script>
</body>
    </html>
    
